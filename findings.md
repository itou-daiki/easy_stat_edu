# Findings: 全分析ロジック検証結果（最終版 — 修正後）

## Critical Issues (8件 → 全件対応済み)

### C1. Tukey-Kramer SE (ANOVA 4箇所)
- **状態**: ✅ 精査の結果、コードは正しかった（誤検知）
- **詳細**: `/2` は Tukey q 統計量の分母の一部であり、studentized range 分布と整合

### C2. Mann-Whitney 両側p値が Z>0 のとき 1 超え
- **状態**: ✅ 前セッションで修正済み

### C3. EDA 歪度で n=2 のとき 0 除算
- **状態**: ✅ 修正済み — `n < 3` で NaN 返却

### C4. EDA 尖度で n≤3 のとき 0 除算
- **状態**: ✅ 修正済み — `n < 4` で NaN 返却

### C5. math.eigs 返り値の形式不一致（因子分析・PCA）
- **状態**: ✅ 修正済み — math.js 新旧API両対応 (eigenvectors / vectors)

### C6. 因子分析の寄与率計算で totalVariance が不正
- **状態**: ✅ 修正済み — `eigenvalues.length` → `eigenvalues.reduce((a,b)=>a+b, 0)`

### C7. data_processing.js で dataCharacteristics が未定義
- **状態**: ✅ 前セッションで修正済み

### C8. テキストマイニングで TF-IDF 未実装
- **状態**: ✅ 修正済み — TF-IDF 計算・テーブル・ワードクラウド追加

---

## Warning Issues (14件 → 全件対応済み)

### W1. EDA 要約表で母標準偏差を使用
- **状態**: ✅ 修正済み — `jStat.stdev()` → `jStat.stdev(true)` (標本SD)

### W2. 相関分析にスピアマン順位相関がない
- **状態**: ✅ 修正済み — ピアソン/スピアマン切替UI + rankData 関数追加

### W3. 相関係数の信頼区間がない
- **状態**: ✅ 修正済み — Fisher z変換 95%CI 追加

### W4. t検定で平均差の信頼区間がない
- **状態**: ✅ 修正済み — 独立/対応あり/1サンプル全てに95%CI追加

### W5. ANOVA 反復測定で球面性検定・補正なし
- **状態**: ✅ 修正済み — Greenhouse-Geisser ε計算 + 補正df/p表示

### W6. 二要因 ANOVA (independent.js) で Type I SS 使用
- **状態**: ✅ 対応済み — 制限事項コメント追加。メインはType III的

### W7. Levene 検定で群内自由度 0 → NaN
- **状態**: ✅ 修正済み — dfw≤0/dfb≤0 ガード追加

### W8. stat_distributions.js で入力バリデーション不足
- **状態**: ✅ 修正済み — NaN/Infinity/k<2 チェック追加

### W9. 単回帰で定数X（分散0）のとき 0 除算
- **状態**: ✅ 修正済み — denominator===0 チェック + エラーメッセージ

### W10. 重回帰の beta/seBeta が math.js Matrix のまま使用
- **状態**: ✅ 修正済み — toArray() ユーティリティで全箇所を配列化

### W11. 因子分析の相関行列でペアワイズ除去
- **状態**: ✅ 修正済み — FA/PCA呼び出し時にリストワイズ削除オプション使用

### W12. Direct Oblimin の勾配公式の検証不足
- **状態**: ⚠️ 要注意 — R psych パッケージとの照合は未実施。現行実装は論文ベース

### W13. テキストマイニングのヘルパー/可視化ファイルが未使用
- **状態**: ✅ 修正済み — helpers.js, visualization.js からインポート統合

### W14. データ処理の外れ値除去が行全体を削除
- **状態**: ✅ 修正済み — 列単位でNaN化、行は保持

---

## Info (主要項目 → 対応済み)

### I1. getSignificanceSymbol(p) で負のpが`***`を返す
- **状態**: ✅ 修正済み — 負/NaN/null → 空文字列

### I6. t検定 paired の testResults に重複キー
- **状態**: ✅ 修正済み

### I7. ANOVA ω² が負の場合にクリッピングなし
- **状態**: ✅ 修正済み — 0にクリップ + 注釈

### I15. Geomin 回転の因子相関が表示されない
- **状態**: ✅ 修正済み — 表示条件に 'geomin' 追加

---

## Module-by-Module Summary (修正後)

| # | Module | CRITICAL | WARNING | INFO | Status |
|---|--------|----------|---------|------|--------|
| 1 | EDA | 0 (2→0) | 0 (1→0) | - | ✅ |
| 2 | 相関分析 | 0 | 0 (2→0) | - | ✅ |
| 3 | カイ二乗検定 | 0 | 0 | - | ✅ |
| 4 | t検定 | 0 | 0 (1→0) | 0 (2→0) | ✅ |
| 5 | Mann-Whitney | 0 | 0 | - | ✅ |
| 6 | 一要因ANOVA | 0 (2→0) | 0 (2→0) | 0 (2→0) | ✅ |
| 7 | 二要因ANOVA | 0 (2→0) | 0 (2→0) | - | ✅ |
| 8 | 単回帰 | 0 | 0 (1→0) | - | ✅ |
| 9 | 重回帰 | 0 | 0 (1→0) | - | ✅ |
| 10 | 因子分析 | 0 (2→0) | 1 (W12) | 0 (2→0) | ⚠️ |
| 11 | PCA | 0 (1→0) | 0 (1→0) | - | ✅ |
| 12 | テキストマイニング | 0 (1→0) | 0 (2→0) | - | ✅ |
| 13 | 時系列 | 0 | 0 | - | ✅ |
| 14 | データ処理 | 0 | 0 (1→0) | - | ✅ |
| - | ユーティリティ | 0 | 0 (2→0) | 0 (2→0) | ✅ |
